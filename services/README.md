# ğŸ›  SANKY License Distribution System - Cloudflareæ§‹æˆä»•æ§˜

## âœ… æ¦‚è¦

SANKYã¯ã€EAï¼ˆExpert Advisorï¼‰ã¨ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã®é…å¸ƒã‚’Webãƒ™ãƒ¼ã‚¹ã§è‡ªå‹•åŒ–ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚  
Cloudflareã®Pagesã€Workersã€R2ã€D1ã‚’æ´»ç”¨ã—ã€ä½ã‚³ã‚¹ãƒˆã‹ã¤é«˜é€Ÿã«ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ç”³è«‹ã€æ‰¿èªã€é€šçŸ¥ã¾ã§ã‚’å®Œçµã•ã›ã¾ã™ã€‚

---

## âœ… æœ€çµ‚å…¨ä½“æ§‹æˆå›³ï¼ˆCloudflareå®Œå…¨çµ±åˆï¼‰

```plaintext
ğŸŒ Cloudflare Pages
â”œâ”€â”€ /apply             â† ç”³è«‹ç”»é¢ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰
â”œâ”€â”€ /status            â† ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèªï¼ˆå£åº§ç•ªå·ã§ç…§ä¼šï¼‰
â”œâ”€â”€ /admin             â† ç®¡ç†ç”»é¢ï¼ˆCloudflare Access ä¿è­·ï¼‰

âš™ï¸ Cloudflare Workers API
â”œâ”€â”€ POST /api/apply          â†’ ç”³è«‹å—ä»˜ï¼ˆD1ç™»éŒ²ï¼‰
â”œâ”€â”€ POST /api/approve        â†’ æ‰¿èª + ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç”Ÿæˆ + R2ä¿å­˜ + é€šçŸ¥
â”œâ”€â”€ POST /api/resend         â†’ å†é€šçŸ¥
â”œâ”€â”€ GET  /api/applications   â†’ ç®¡ç†UIç”¨ ä¸€è¦§å–å¾—
â”œâ”€â”€ GET  /api/eas            â†’ EAãƒªã‚¹ãƒˆå–å¾—
â”œâ”€â”€ GET  /api/status/:accountId â†’ ç”³è«‹çŠ¶æ³å–å¾—

ğŸ“¦ R2ï¼ˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼‰
â”œâ”€â”€ eas/StrategyA.ex4
â”œâ”€â”€ eas/StrategyB.ex5
â””â”€â”€ licenses/{accountId}/{eaType}.lic ï¼ˆBase64ãƒ†ã‚­ã‚¹ãƒˆï¼‰

ğŸ—ƒï¸ D1ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰
â”œâ”€â”€ applicationsï¼ˆç”³è«‹æƒ…å ±ï¼‰
â”œâ”€â”€ licensesï¼ˆãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç™ºè¡Œå±¥æ­´ï¼‰
â””â”€â”€ easï¼ˆEAã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ç¨®é¡ï¼‰

ğŸ“© SendGrid
- æ‰¿èªæ™‚ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯é€šçŸ¥

ğŸ” Cloudflare Access
- `/admin` ä»¥ä¸‹ã‚’ä¿è­·ï¼ˆãƒ¡ãƒ¼ãƒ«ãƒ‰ãƒ¡ã‚¤ãƒ³ or æŒ‡å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰

ğŸ” ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç”Ÿæˆæ–¹å¼
- AES-CBC + HMACï¼ˆNode.jsã§ Workers ã«ç§»æ¤æ¸ˆï¼‰
```

---

## ğŸ“‚ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```plaintext
sanky-license/
â”œâ”€â”€ wrangler.toml
â”œâ”€â”€ public/                     # Pages UI (/apply, /admin, /status)
â”œâ”€â”€ functions/
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ apply.ts            # POST: ç”³è«‹å—ä»˜
â”‚       â”œâ”€â”€ approve.ts          # POST: æ‰¿èª + ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç”Ÿæˆ + é€šçŸ¥
â”‚       â”œâ”€â”€ resend.ts           # POST: å†é€šçŸ¥
â”‚       â”œâ”€â”€ applications.ts     # GET: ç”³è«‹ä¸€è¦§ï¼ˆç®¡ç†ç”»é¢ç”¨ï¼‰
â”‚       â”œâ”€â”€ eas.ts              # GET: EAç¨®é¡ä¸€è¦§
â”‚       â””â”€â”€ status/[accountId].ts # GET: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ crypto.ts               # AES-CBC + HMACæš—å·åŒ–å‡¦ç†
â”‚   â”œâ”€â”€ r2.ts                   # R2ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã¨ç½²åURLç”Ÿæˆ
â”‚   â”œâ”€â”€ db.ts                   # D1ã‚¢ã‚¯ã‚»ã‚¹
â”‚   â””â”€â”€ mail.ts                 # SendGridé€ä¿¡å‡¦ç†
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ licenseEmail.md         # ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â””â”€â”€ .env                        # ç’°å¢ƒå¤‰æ•°ï¼ˆé–‹ç™ºç”¨ï¼‰
```

---

## ğŸ“ ãã®ä»–ä»•æ§˜

ï¼ˆä¸­ç•¥ï¼šå‰å›ã¨åŒæ§˜ã®ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã€æš—å·åŒ–æ–¹å¼ã€ç”³è«‹ãƒ•ãƒ­ãƒ¼ã€ãƒ„ãƒ¼ãƒ«é¡ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ãªã©ï¼‰

---

## ğŸ“Œ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—å€™è£œ

- Wranglerãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é››å½¢ç”Ÿæˆ
- Pages UIã®ç”³è«‹/ç®¡ç†ç”»é¢åˆæœŸå®Ÿè£…
- API `/apply`, `/approve`, `/resend` ã®å®Ÿè£…é–‹å§‹
- Cloudflare R2ã®ç½²åä»˜ãURLã‚³ãƒ¼ãƒ‰çµ±åˆ
