
# SANKY License System

<p align="center">
  <img src="./docs/assets/logo.png" alt="Sankey Logo" width="200"/>
</p>




---
## ðŸ§¾ æ¦‚è¦

**SANKY License System** ã¯ã€MetaTrader å‘ã‘ã® EA ã«å¯¾ã—ã¦ã€å®‰å…¨ã‹ã¤æŸ”è»Ÿãªãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ã‚’æä¾›ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚  
AES-CBC ã«ã‚ˆã‚‹æš—å·åŒ–ã¨ HMAC-SHA256 ã«ã‚ˆã‚‹æ”¹ã–ã‚“æ¤œå‡ºã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€**é€šä¿¡ä¸è¦ãƒ»é«˜ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»å†é…å¸ƒé˜²æ­¢**ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

- âœ… **é…å¸ƒã•ã‚Œã‚‹ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã¯Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æ¸ˆã¿ã®è‡ªå·±å®Œçµåž‹ãƒˆãƒ¼ã‚¯ãƒ³**
- âœ… **accountIdï¼ˆå£åº§ç•ªå·ï¼‰ã¨å¼·ãçµã³ä»˜ã‘ã‚‰ã‚Œã¦ãŠã‚Šã€æµç”¨ä¸å¯**
- âœ… **payloadã¯JSONå½¢å¼ã§ã‚ã‚Šã€æœŸé™ã‚„æ©Ÿèƒ½åˆ¶å¾¡ãŒå¯èƒ½**
- âœ… **å®Œå…¨ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç’°å¢ƒã§ã‚‚EAå˜ä½“ã§æ¤œè¨¼å¯èƒ½**

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€æš—å·åŒ–å‡¦ç†ã¨å¾©å·å‡¦ç†ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’å›³è§£ã¨ã¨ã‚‚ã«èª¬æ˜Žã—ã€ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®æ§‹æˆæ„å›³ã‚’æ˜Žã‚‰ã‹ã«ã—ã¾ã™ã€‚

---

## ðŸ§  å‡¦ç†èª¬æ˜Žã¨è¨­è¨ˆã®ç‹™ã„

### ðŸ” æš—å·åŒ–ã®ç›®çš„
- åˆ©ç”¨è€…ã«é…å¸ƒã™ã‚‹ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æ–‡å­—åˆ—ã«ã€**æ©Ÿå¯†æ€§ï¼ˆAES-CBCï¼‰**ã¨**å®Œå…¨æ€§ï¼ˆHMACï¼‰**ã®ä¸¡æ–¹ã‚’æ‹…ä¿
- HMACã¯ `IV + ciphertext + accountId` ã‚’å¯¾è±¡ã¨ã™ã‚‹ãŸã‚ã€
  - æ”¹ã–ã‚“ï¼ˆbit flipæ”»æ’ƒï¼‰
  - ä»–äººã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æµç”¨ï¼ˆaccountIdå·®ã—æ›¿ãˆï¼‰
  ãŒã„ãšã‚Œã‚‚å¤±æ•—ã™ã‚‹æ§‹é€ 

### ðŸ“¦ payloadæ§‹é€ ã¨æ‹¡å¼µæ€§

æš—å·åŒ–å¯¾è±¡ã§ã‚ã‚‹ `payload` ã¯ **JSONãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆ** ã‚’æŽ¡ç”¨ã—ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæŸ”è»Ÿãªåˆ¶å¾¡ãŒå¯èƒ½ã§ã™ï¼š

```json
{
  "name": "Example User",
  "email": "user@example.com",
  "expiryDate": "2025-12-31",
  "features": ["basic", "pro"]
}
```

ã“ã®å½¢å¼ã«ã‚ˆã‚Šï¼š

- âœ… ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®**æœ‰åŠ¹æœŸé™**åˆ¶å¾¡ï¼ˆexpiryDateï¼‰  
- âœ… æ©Ÿèƒ½åˆ¶é™ï¼ˆ`features` ã«ã‚ˆã‚‹ãƒ—ãƒ©ãƒ³åˆ¶å¾¡ï¼‰  
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®ç…§åˆã‚„å†…éƒ¨ãƒ­ã‚°å‡ºåŠ›ã«ã‚‚æ´»ç”¨å¯èƒ½

### ðŸ›¡ å®‰å…¨è¨­è¨ˆãƒã‚¤ãƒ³ãƒˆ

- AESéµã¯256bitï¼ˆ32ãƒã‚¤ãƒˆï¼‰ã€IVã¯æ¯Žå›žãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆ
- HMAC-SHA256ã®çµæžœã¯32ãƒã‚¤ãƒˆï¼ˆ256bitï¼‰
- `accountId` ã‚’HMACã«æ··ãœã‚‹ã“ã¨ã§ã€**EAãŒç‰¹å®šå£åº§ã§ã®ã¿èµ·å‹•å¯èƒ½**ãªä»•çµ„ã¿ã‚’æ§‹æˆ

---

## âœ… çµè«–

ã“ã®æ–¹å¼ã«ã‚ˆã‚Šã€**é€šä¿¡ãªã—ã§EAãŒè‡ªå¾‹çš„ã«ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’æ¤œè¨¼ãƒ»åˆ¶å¾¡**ã§ãã€  
é…å¸ƒãƒ»é‹ç”¨ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ã™ã¹ã¦ã®é¢ã§é«˜ã„ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã‚’ç¢ºä¿ã—ã¾ã™ã€‚



## ðŸ”’ æš—å·åŒ–å‡¦ç†

```mermaid
flowchart TD
    A["å…¥åŠ›: payload, accountId, AESéµ"]
    B["ãƒ©ãƒ³ãƒ€ãƒ IVç”Ÿæˆï¼ˆ16ãƒã‚¤ãƒˆï¼‰"]
    C["AES-CBCæš—å·åŒ–(payload) â†’ ciphertext"]
    D["HMAC-SHA256(key, IV + ciphertext + accountId)"]
    E1["IV"]
    E2["HMAC"]
    E3["ciphertext"]
    F["IV + HMAC + ciphertext ã‚’é€£çµ"]
    G["Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ â†’ licenseB64"]

    A --> B --> C
    A --> D
    B --> C
    C --> D
    D --> E2
    B --> E1
    C --> E3
    E1 --> F
    E2 --> F
    E3 --> F
    F --> G
```

---

## ðŸ§ª å¾©å·å‡¦ç†

```mermaid
flowchart TD
    A["å—ä¿¡: licenseB64"]
    B["Base64 decode"]
    C["IV + HMAC + Ciphertext"]
    D1["IVï¼ˆ16Bï¼‰"]
    D2["HMACéƒ¨ï¼ˆ32Bï¼‰"]
    D3["Ciphertext"]
    E["HMAC-SHA256(key, IV + ciphertext + accountId)"]
    F["compare"]
    G["AESå¾©å·"]
    H["JSON payloadå¾©å…ƒ"]

    A --> B --> C
    C --> D1
    C --> D2 --> F
    C --> D3
    E --> F
    D1 --> G
    D3 --> G
    F --> G
    G --> H
```

---

